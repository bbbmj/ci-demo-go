integration:
  services:
    mongo:
      image: index.caicloud.io/caicloud/mongo:3.0.5
      command: mongod --smallfiles
  image: index.caicloud.io/caicloud/golang:1.6
  environment:
    - BUILD_DIR=/go/src/github.com/caicloud/ci-demo-go
  commands: 
    - mkdir -p $BUILD_DIR
    - cp ./ -rf $BUILD_DIR
    - cd $BUILD_DIR/code
    - go build -v -o app
    - $BUILD_DIR/code/app &
    - echo "do some test"

pre_build:
  image: index.caicloud.io/caicloud/golang:1.6
  volumes:
    - .:/go/src/github.com/caicloud/ci-demo-go
  commands:
    - echo "compile executable files"
    - cd /go/src/github.com/caicloud/ci-demo-go/code
    - go build -v -o app
  outputs:
    - /go/src/github.com/caicloud/ci-demo-go/code/app

build:
  dockerfile_name: Dockerfile_publish
